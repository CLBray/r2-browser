name = "r2-file-explorer-api"
main = "src/index.ts"
compatibility_date = "2024-01-01"

# Static assets configuration for React frontend
[assets]
directory = "../frontend/dist"
binding = "ASSETS"

# Development R2 bucket binding for file storage
[[r2_buckets]]
binding = "R2_BUCKET"
bucket_name = "file-explorer-storage-dev"

# Development KV namespace for session storage
[[kv_namespaces]]
binding = "KV_SESSIONS"
id = "file-explorer-sessions-dev"
preview_id = "file-explorer-sessions-dev-preview"

# Analytics Engine binding for observability
[[analytics_engine_datasets]]
binding = "ANALYTICS"
dataset = "r2_file_explorer_analytics"

# Development environment variables
[vars]
JWT_SECRET = "dev-secret-key-for-local-development-only-not-secure"
CORS_ORIGINS = "http://localhost:5173,http://127.0.0.1:5173,http://localhost:3000"
JWT_EXPIRY_HOURS = "24"
MAX_FILE_SIZE_MB = "50"
ENVIRONMENT = "development"

# Staging environment configuration
[env.staging]
name = "r2-file-explorer-api-staging"

# Staging R2 bucket binding
[[env.staging.r2_buckets]]
binding = "R2_BUCKET"
bucket_name = "file-explorer-storage-staging"

# Staging KV namespace binding
[[env.staging.kv_namespaces]]
binding = "KV_SESSIONS"
id = "file-explorer-sessions-staging"
preview_id = "file-explorer-sessions-staging-preview"

# Staging Analytics Engine binding
[[env.staging.analytics_engine_datasets]]
binding = "ANALYTICS"
dataset = "r2_file_explorer_analytics"

[env.staging.vars]
JWT_SECRET = "REPLACE_WITH_SECURE_STAGING_SECRET"
CORS_ORIGINS = "https://r2-file-explorer-api-staging.your-subdomain.workers.dev"
JWT_EXPIRY_HOURS = "12"
MAX_FILE_SIZE_MB = "100"
ENVIRONMENT = "staging"

# Production environment configuration
[env.production]
name = "r2-file-explorer-api-prod"

# Production R2 bucket binding
[[env.production.r2_buckets]]
binding = "R2_BUCKET"
bucket_name = "file-explorer-storage-prod"

# Production KV namespace binding
[[env.production.kv_namespaces]]
binding = "KV_SESSIONS"
id = "file-explorer-sessions-prod"
preview_id = "file-explorer-sessions-prod-preview"

# Production Analytics Engine binding
[[env.production.analytics_engine_datasets]]
binding = "ANALYTICS"
dataset = "r2_file_explorer_analytics"

[env.production.vars]
JWT_SECRET = "REPLACE_WITH_SECURE_PRODUCTION_SECRET"
CORS_ORIGINS = "https://r2-file-explorer-api-prod.your-subdomain.workers.dev"
JWT_EXPIRY_HOURS = "8"
MAX_FILE_SIZE_MB = "200"
ENVIRONMENT = "production"